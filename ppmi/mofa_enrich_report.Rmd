---
output:
  html_document: default
  pdf_document: default
  css: styles.css
params: 
      outdir: '/data8TB/efiath/git/mofa_tutorial/ppmi/plots/48bcb908/'
      title: 'Mofa Clusters comparisons - V08'
      nf: c(2, 11, 23)

---

---
title:  `r params$title`
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)


```

## Mofa Enrichment analysis 



```{r Enrichment,  results='hide', echo=FALSE, message=FALSE  }

print(getwd())

cell_corr_deseq = TRUE
#VISIT='V08'
source(paste0('../ppmi/setup_os.R'))
script_dir
data_dir



VISIT=c('BL','V08');
VISIT=c('BL','V04', 'V06',  'V08');
VISIT=c('V08');




run_vsn=TRUE
## tissue is set in the config
use_signif=FALSE
process_mirnas=FALSE
run_mofa_complete<-FALSE
run_rna_mirna<-FALSE
cell_corr_mofa=FALSE

TISSUE='CSF'
tissue_un = 'Cerebrospinal Fluid'
prot_mode = 't'

source(paste0(script_dir, '/ppmi/config.R'))
source(paste0(script_dir, '/ppmi/mofa_config.R'))
source(paste0(script_dir, '/ppmi/mofa_dirs.R'))
source(paste0(script_dir,'ppmi/utils.R'))





#source(paste0(script_dir, 'ppmi/mofa_application_ppmi_all_visits.R'))

outdir_enrich<-paste0(outdir, '/enrichment/' )







#source('ppmi/RNAseq enrichment.R')

#
#p_enrich


```





```{r get_enrich_files, echo=FALSE}
#nf=c(2,4,6,18,22)
#nf=c(4,6)
nf=c(2,11, 23)
nf=c(13,15,20,24,28)


get_files_weights<-function(outdir){
    en_plots_all=c()

    for (f in nf){
        regex_str<-paste0('top_weights_f_', f, '.*20')
        en_plots<-list.files(paste0(outdir, '/top_weights/'), pattern = regex_str, full.names =  TRUE)
        en_plots_all<-append(en_plots_all, en_plots)

    }
    return(en_plots_all)
}



get_files<-function(outdir_enrich, type=''){
    en_plots_all=c()

    for (f in nf){
        regex_str<-paste0('detailed.*', f )
        en_plots<-list.files(outdir_enrich, pattern = regex_str, full.names =  TRUE)
        en_plots_all<-append(en_plots_all, en_plots)

    }
    return(en_plots_all)
}





en_plots_all<-get_files(outdir_enrich)
en_plots_all_proteins<-get_files(paste0(outdir_enrich, '/pcgse/proteomics_plasma/'))
en_plots_all_proteins_csf<-get_files(paste0(outdir_enrich, '/pcgse/proteomics_csf/'))
en_plots_all_proteins_t_csf<-get_files(paste0(outdir_enrich, '/pcgse/proteomics_t_csf/'))
en_plots_all_proteins_t_plasma<-get_files(paste0(outdir_enrich, '/pcgse/proteomics_t_plasma/'))
en_plots_all_rna<-get_files(paste0(outdir_enrich, '/pcgse/RNA/'))

en_plots_all_proteins_csf

#plot_settings
out_width="33%"
out_width_w = "25%"

```

## Top weighted molecules 


```{r plot_weights, echo=FALSE, fig.width=25, fig.height=7, out.width = out_width_w, fig.cap="weights",fig.show='hold',fig.align='center'}

weight_plots<-get_files_weights(outdir)

length(weight_plots)
#print(paste('plots', weight_plots))
if (length(weight_plots)>1){
  knitr::include_graphics(weight_plots, dpi = 96 )

}else{
  print('Could not find files ')
}


weight_plots

```

## Enrichment analysis 
### DotPlots  

```{r plot, echo=FALSE, fig.width=25, fig.height=7, out.width = out_width, fig.cap="RNA",fig.show='hold',fig.align='center'}



 print(paste("0.01, -0.14, 0.03, 0.3, -0.05, -0.21, 0.1, 0.07, 0, 0.06, -0.05, 0.03, 0.07, 0.09, -0.09, -0.02, 0.1, -0.15, -0.01, -0.02, -0.04, -0.16, 0.03, 0.03, -0.02"))
knitr::include_graphics(en_plots_all, dpi = 96 )

```



```{r plot_proteins, echo=FALSE, fig.width=25, fig.height=7, out.width = out_width, fig.cap="proteins",fig.show='hold',fig.align='center'}


    knitr::include_graphics(en_plots_all_rna, dpi = 96 )

    knitr::include_graphics(en_plots_all_proteins, dpi = 96 )
    knitr::include_graphics(en_plots_all_proteins_csf, dpi = 96 )
    knitr::include_graphics(en_plots_all_proteins_t_csf, dpi = 96 )

    knitr::include_graphics(en_plots_all_proteins_t_plasma, dpi = 96 )
    



         

#}
```

